# FaceEdit

## О работе

Эта работа основана на нескольких исследованиях. Больший упор был сделан на статью о нейронной модели StarGAN [1], которая первая в своем роде использовала метод обучения модели, решающий задачу трансляции изображений, с помощью одного генератора и одного дискриминатора. Имеющиеся до этого работы реализовали семантическое редактирование лиц посредством использования множественного числа генераторов и дискриминаторов.

Обобщенный процесс обучения модели StarGAN выглядит следующим образом:


<img src="https://github.com/AverichkinaVictoria/FaceEdit/blob/dev/Screenshots/4.png" width="500">



Процесс обработки изображения имеет следующую структуру:


![Alt text](https://github.com/AverichkinaVictoria/FaceEdit/blob/dev/Screenshots/5.png)


Таким образом, можно выделить 4 основные фазы обработки изображения:

1. Детекция лица.
   
   В первую очередь перед началом цикла обработки изображения, полученного на вход, необходимо определить содержит ли изображение лицо человека. Для этого используется детекция лица. После обработки изображения алгоритмом машинного обучения на выходе функции выдается массив, объекты которого – координаты четырех точек, которые составляют прямоугольник, в котором расположено лицо на фотографии. Таким образом, если алгоритм обнаруживает на изображении более одного лица, то используются координаты того лица, которое занимает бóльшую площадь на изображении.

2. Предобработка изображения.
   
   После того, как была проведена детекция лица на изображении и оно было обрезано, наступает фаза предобработки изображения. В рамках данной фазы изображение обрабатывается посредством использования transforms из пакета torchvision.

3. Выделение вектора атрибутов из текста.
   
   Следующая фаза работы программы заключается в получении вектора атрибутов. Если вектор атрибутов был задан пользователем, то все, что необходимо сделать на данном этапе привести его к формату тензора, который будет подаваться на вход модели. Если же пользователь отметил входным форматом текст-описание, то программа запускает алгоритм выделения атрибутов из текста-описания.
   
   Алгоритм выделения атрибутов из текста-описания содержит следующие основные этапы:
   
   1. Детекция языка текста-описания.
   
   2. Токенизация текста-описания.
   
   3. Удаление стоп-слов и пунктуации.
   
   4. Лемматизация токенов.
   
   5. Выделение значимых токенов.
   
   6. Преобразование списка значимых токенов в вектор атрибутов.

4. Генерация итогового изображения.
   
   Финальный этап работы программы – генерация итогового изображения. К моменту данного этапа программа уже имеет предобработанное изображение с лицом, а также вектор атрибутов, которыми должно обладать выходное изображение после генерации.
Генерация итогового изображения происходит благодаря обработке входного изображения нейронной сетью StarGAN.

## Результаты работы
 
На рисунке продемонстрированы входное изображение и результат работы программы со следующими параметрами конфигурации:

•	Способ ввода – вектор атрибутов

•	Цвет волос – темный

•	Пол – женский

•	Возраст – молодой


```bash

python main.py --test_input_choice attrs --test_img_path test --test_img_name test.jpg --test_img_attrs 1 0 0 0 1

```



![Alt text](https://github.com/AverichkinaVictoria/FaceEdit/blob/dev/Screenshots/1.png)


 
На рисунке продемонстрированы входное изображение и результат работы программы со следующими параметрами конфигурации:

•	Способ ввода – текстовое описание

•	Текст-описание: «I wanna change my appearance. The hair should be blond, sex remains women, and i wanna see myself young.». 

```bash

python main.py --test_input_choice text --test_input_text 'I wanna change my appearance. The hair should be blond, sex remains women, and i wanna see myself young.' --test_img_path test --test_img_name test.jpg

```

![Alt text](https://github.com/AverichkinaVictoria/FaceEdit/blob/dev/Screenshots/2.png)



На рисунке продемонстрированы входное изображение и результат работы программы со следующими параметрами конфигурации:

•	Способ ввода – текстовое описание

•	Текст-описание: «Я хочу изменить свою внешность. Волосы перекрасить в коричневый, пол сменить на мужской, и увидеть себя в молодости.».

```bash
python main.py --test_input_choice text --test_input_text 'Я хочу изменить свою внешность. Волосы перекрасить в коричневый, пол сменить на мужской, и увидеть себя в молодости.' --test_img_path test --test_img_name test.jpg

```


![Alt text](https://github.com/AverichkinaVictoria/FaceEdit/blob/dev/Screenshots/3.png)


[1] Choi Y. Stargan: Unified generative adversarial networks for multi-domain image-toimage translation //Proceedings of the IEEE conference on computer vision and pattern recognition. – 2018. – С. 8789-8797.

